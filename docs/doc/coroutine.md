## åç¨‹å…¥é—¨

æœ¬ç« èŠ‚ä»¥swowçš„ä½¿ç”¨æ¥ä¸¾ä¾‹ä»‹ç»åç¨‹ã€‚

#### 1. åç¨‹åˆ›å»º

Swow çš„åç¨‹æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ªå¾…è¿è¡Œçš„åç¨‹
```php
use Swow\Coroutine;

$coroutine = new Coroutine(static function (): void {
    echo "Hello å¼€æºæŠ€æœ¯å°æ ˆ\n";
});
```
è¿™æ ·åˆ›å»ºå‡ºæ¥çš„åç¨‹å¹¶ä¸ä¼šè¢«è¿è¡Œï¼Œè€Œæ˜¯åªè¿›è¡Œäº†å†…å­˜çš„ç”³è¯·ã€‚

#### 2. åç¨‹çš„è§‚æµ‹

é€šè¿‡ `var_dump` æ‰“å°åç¨‹å¯¹è±¡ï¼Œæˆ‘ä»¬åˆå¯ä»¥çœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š
```
var_dump($coroutine);
```
æ‰“å°è¾“å‡º
```ts
class Swow\Coroutine#240 (4) {
  public $id =>
  int(12)
  public $state =>
  string(7) "waiting"
  public $switches =>
  int(0)
  public $elapsed =>
  string(3) "0ms"
}
```
ä»è¾“å‡ºæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›åç¨‹çŠ¶æ€çš„ä¿¡æ¯ï¼Œå¦‚ï¼šåç¨‹çš„ `id` æ˜¯`12`ï¼ŒçŠ¶æ€æ˜¯`ç­‰å¾…ä¸­`ï¼Œåˆ‡æ¢æ¬¡æ•°æ˜¯`0`ï¼Œè¿è¡Œäº†`0`æ¯«ç§’ï¼ˆå³æ²¡æœ‰è¿è¡Œï¼‰ã€‚

é€šè¿‡ `resume()` æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å”¤é†’è¿™ä¸ªåç¨‹ï¼š
```
$coroutine->resume();
```
åç¨‹ä¸­çš„PHPä»£ç è¢«æ‰§è¡Œï¼Œäºæ˜¯æˆ‘ä»¬å°±çœ‹åˆ°äº†ä¸‹è¿°ä¿¡æ¯ï¼š
```yaml
Hello å¼€æºæŠ€æœ¯å°æ ˆ
```
è¿™æ—¶å€™æˆ‘ä»¬å†é€šè¿‡ `var_dump($coroutine);` å»æ‰“å°åç¨‹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š
```ts
class Swow\Coroutine#240 (4) {
  public $id =>
  int(12)
  public $state =>
  string(4) "dead"
  public $switches =>
  int(1)
  public $elapsed =>
  string(3) "0ms"
}
```
å¯ä»¥çœ‹åˆ°åç¨‹å·²ç»è¿è¡Œå®Œäº†æ‰€æœ‰çš„ä»£ç å¹¶è¿›å…¥`dead`çŠ¶æ€ï¼Œå…±ç»å†ä¸€æ¬¡åç¨‹åˆ‡æ¢ã€‚

## åç¨‹å®æˆ˜

#### å¤šè¿›ç¨‹å’Œåç¨‹æ‰§è¡Œé¡ºåº

![image](https://github.com/user-attachments/assets/16fb3138-52ae-4ed1-9c15-bf51c6151fe3)

#### å®æˆ˜ä¼ªä»£ç 

```shell
/** @desc ä»»åŠ¡1  */
function task1(): void
{
    // æ€»å…±3s
    for ($i = 0; $i < 3; $i++) {
        // å†™å…¥æ–‡ä»¶
        sleep(1);
        echo '[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [' . $i . '] ' . date('Y-m-d H:i:s') . PHP_EOL;
    }
}

/** @desc ä»»åŠ¡2 */
function task2(): void
{
    // æ€»å…±5s
    for ($i = 0; $i < 5; $i++) {
        // å‘é€é‚®ä»¶ç»™50åä¼šå‘˜,
        sleep(1);
        echo '[x] [ğŸ] [å‘é€é‚®ä»¶] [' . $i . '] ' . date('Y-m-d H:i:s') . PHP_EOL;
    }
}

/** @desc ä»»åŠ¡3  */
function task3(): void
{
    // æ€»å…±10s
    for ($i = 0; $i < 10; $i++) {
        // æ¨¡æ‹Ÿæ’å…¥10
        sleep(1);
        echo '[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [' . $i . '] ' . date('Y-m-d H:i:s') . PHP_EOL;
    }
}
```
#### æ™®é€šè¯·æ±‚æ‰§è¡Œ
**æ‰§è¡Œä»£ç **
```php
$timeOne = microtime(true);
task1();
task2();
task3();
$timeTwo = microtime(true);
echo '[x] [è¿è¡Œæ—¶é—´] ' . ($timeTwo - $timeOne) . PHP_EOL;
```
**æ‰“å°ç»“æœ**
```shell
[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [0] 2024-09-28 08:54:26
[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [1] 2024-09-28 08:54:27
[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [2] 2024-09-28 08:54:28
[x] [ğŸ] [å‘é€é‚®ä»¶] [0] 2024-09-28 08:54:29
[x] [ğŸ] [å‘é€é‚®ä»¶] [1] 2024-09-28 08:54:30
[x] [ğŸ] [å‘é€é‚®ä»¶] [2] 2024-09-28 08:54:31
[x] [ğŸ] [å‘é€é‚®ä»¶] [3] 2024-09-28 08:54:32
[x] [ğŸ] [å‘é€é‚®ä»¶] [4] 2024-09-28 08:54:33
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [0] 2024-09-28 08:54:34
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [1] 2024-09-28 08:54:35
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [2] 2024-09-28 08:54:36
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [3] 2024-09-28 08:54:37
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [4] 2024-09-28 08:54:38
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [5] 2024-09-28 08:54:39
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [6] 2024-09-28 08:54:40
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [7] 2024-09-28 08:54:41
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [8] 2024-09-28 08:54:42
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [9] 2024-09-28 08:54:43
[x] [è¿è¡Œæ—¶é—´] 18.004005908966
```

> å¯ä»¥çœ‹å‡ºä»¥ä¸Šä»£ç æ˜¯`é¡ºåºæ‰§è¡Œ`çš„ï¼Œæ‰§è¡Œè¿è¡Œæ—¶é—´`18.004005908966`ç§’

#### ğŸš€ åç¨‹åŠ æŒæ‰§è¡Œ

**æ‰§è¡Œä»£ç **
```php
$timeOne = microtime(true);
\Swow\Coroutine::run(function () {
    task1();
});
\Swow\Coroutine::run(function () {
    task2();
});
\Swow\Coroutine::run(function () {
    task3();
});
$timeTwo = microtime(true);
echo '[x] [è¿è¡Œæ—¶é—´] ' . ($timeTwo - $timeOne) . PHP_EOL;
```

**æ‰“å°ç»“æœ**
```shell
[x] [è¿è¡Œæ—¶é—´] 5.5074691772461E-5
```
> è¿™æ˜¯å› ä¸ºåç¨‹åŒ–ä»¥åï¼Œåç¨‹ä¹‹é—´æ˜¯å¼‚æ­¥çš„ï¼Œä¸»åç¨‹å¹¶æ²¡æœ‰ç­‰å¾…ä»»åŠ¡çš„åç¨‹ç»“æœï¼Œæ‰€ä»¥æ‰§è¡Œæ—¶é—´`5.5074691772461E-5`ç§’ã€‚

**æ”¹é€ ä»£ç **

- ä½¿ç”¨waitGroup
```php
$wg = new \Swow\Sync\WaitGroup();
$wg->add(3);
$timeOne = microtime(true);
\Swow\Coroutine::run(function () use ($wg) {
    task1();
    $wg->done();
});
\Swow\Coroutine::run(function () use ($wg) {
    task2();
    $wg->done();
});
\Swow\Coroutine::run(function () use ($wg) {
    task3();
    $wg->done();
});
// ç­‰å¾…åç¨‹å®Œæ¯•
$wg->wait();
$timeTwo = microtime(true);
echo '[x] [è¿è¡Œæ—¶é—´] ' . ($timeTwo - $timeOne) . PHP_EOL;
```

- ä½¿ç”¨waitAll()ï¼Œ**webman/workermanç¯å¢ƒä¸‹è¯·ä½¿ç”¨waitGroup**
```php
$timeOne = microtime(true);
\Swow\Coroutine::run(function () {
    task1();
});
\Swow\Coroutine::run(function () {
    task2();
});
\Swow\Coroutine::run(function () {
    task3();
});
// ç­‰å¾…åç¨‹å®Œæ¯•
waitAll();
$timeTwo = microtime(true);
echo '[x] [è¿è¡Œæ—¶é—´] ' . ($timeTwo - $timeOne) . PHP_EOL;
```

**æ‰“å°ç»“æœ**
```shell
[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [0] 2024-09-28 09:02:46
[x] [ğŸ] [å‘é€é‚®ä»¶] [0] 2024-09-28 09:02:46
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [0] 2024-09-28 09:02:46
[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [1] 2024-09-28 09:02:47
[x] [ğŸ] [å‘é€é‚®ä»¶] [1] 2024-09-28 09:02:47
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [1] 2024-09-28 09:02:47
[x] [ğŸ•·ï¸] [å†™å…¥æ–‡ä»¶] [2] 2024-09-28 09:02:48
[x] [ğŸ] [å‘é€é‚®ä»¶] [2] 2024-09-28 09:02:48
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [2] 2024-09-28 09:02:48
[x] [ğŸ] [å‘é€é‚®ä»¶] [3] 2024-09-28 09:02:49
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [3] 2024-09-28 09:02:49
[x] [ğŸ] [å‘é€é‚®ä»¶] [4] 2024-09-28 09:02:50
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [4] 2024-09-28 09:02:50
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [5] 2024-09-28 09:02:51
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [6] 2024-09-28 09:02:52
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [7] 2024-09-28 09:02:53
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [8] 2024-09-28 09:02:54
[x] [ğŸŒ¾] [æ’å…¥æ•°æ®] [9] 2024-09-28 09:02:55
[x] [è¿è¡Œæ—¶é—´] 9.4166378974915
```

> ä¸»åç¨‹ç­‰å¾…å­åç¨‹ï¼Œå­åç¨‹äº¤æ›¿è¿è¡Œï¼Œæ‰§è¡Œæ—¶é—´`9.4166378974915`ç§’ã€‚
